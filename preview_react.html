<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Email, Gender & City Admin Panel</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
      body {
        background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
      }
      .sidebar {
        min-width: 220px;
        max-width: 220px;
        background: #3358e0;
        color: #fff;
        min-height: 100vh;
        transition: all 0.3s;
        z-index: 1040;
      }
      .sidebar .nav-link {
        color: #cfd8ff;
        font-weight: 500;
        border-radius: 0.5rem;
        margin-bottom: 0.25rem;
        transition: background 0.2s, color 0.2s;
      }
      .sidebar .nav-link.active, .sidebar .nav-link:hover {
        background: #4f8cff;
        color: #fff;
      }
      .sidebar .sidebar-header {
        font-size: 1.35rem;
        font-weight: bold;
        letter-spacing: 1px;
        padding: 1.5rem 1rem 1rem 1rem;
        border-bottom: 1px solid rgba(255,255,255,0.08);
      }
      .sidebar .nav {
        margin-top: 1.5rem;
      }
      .main-content {
        flex: 1 1 0%;
        min-width: 0;
        padding: 2rem 1rem 1rem 1rem;
        transition: margin-left 0.3s;
      }
      .navbar {
        background: #fff;
        box-shadow: 0 2px 8px rgba(51,88,224,0.07);
        z-index: 1050;
      }
      .sidebar-collapsed {
        min-width: 0 !important;
        max-width: 0 !important;
        width: 0 !important;
        overflow: hidden !important;
        padding: 0 !important;
      }
      .sidebar-toggler {
        border: none;
        background: none;
        color: #3358e0;
        font-size: 1.5rem;
        margin-right: 1rem;
      }
      @media (max-width: 991.98px) {
        .sidebar {
          position: fixed;
          left: 0;
          top: 0;
          height: 100vh;
          min-height: 100vh;
          z-index: 2000;
          transform: translateX(-100%);
          transition: transform 0.3s;
        }
        .sidebar.open {
          transform: translateX(0);
        }
        .main-content {
          padding-top: 2.5rem;
        }
        .overlay {
          position: fixed;
          top: 0; left: 0; right: 0; bottom: 0;
          background: rgba(51,88,224,0.15);
          z-index: 1999;
          display: none;
        }
        .overlay.show {
          display: block;
        }
      }
      /* Hide overlay on desktop/laptop */
      @media (min-width: 992px) {
        .overlay {
          display: none !important;
        }
      }
      .form-section {
        max-width: 420px;
        width: 100%;
        margin: 0 auto 2rem auto;
      }
      .card {
        border-radius: 1.25rem;
      }
      .btn-primary {
        background: linear-gradient(90deg, #4f8cff 0%, #3358e0 100%);
        border: none;
      }
      .btn-primary:hover, .btn-primary:focus {
        background: linear-gradient(90deg, #3358e0 0%, #4f8cff 100%);
        box-shadow: 0 4px 16px rgba(79, 140, 255, 0.15);
      }
      .table-responsive {
        border-radius: 1.25rem;
        overflow: hidden;
      }
      .spinner-container {
        min-height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .fade-in {
        animation: fadeIn 0.7s;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
    <script type="text/babel">
      const SUPABASE_URL = 'https://ydmumpaarisrlnpybhcp.supabase.co';
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkbXVtcGFhcmlzcmxucHliaGNwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNjc5MjEsImV4cCI6MjA3Mjc0MzkyMX0.RFsW2XO3VxR-KoPjGLXfhLZs9gCoz--vGdlFI5hq6sQ';
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

      function Sidebar({ collapsed, open, onClose, active, setActive }) {
        React.useEffect(() => {
          // Only lock scroll if overlay is visible (mobile/tablet)
          if (window.innerWidth < 992 && open) {
            document.body.style.overflow = 'hidden';
          } else {
            document.body.style.overflow = '';
          }
        }, [open]);
        return (
          <>
            <div className={`sidebar d-flex flex-column${open ? ' open' : ''}${collapsed ? ' sidebar-collapsed' : ''}`}
              style={{ position: window.innerWidth < 992 ? 'fixed' : 'relative' }}>
              <div className="sidebar-header d-flex align-items-center justify-content-between">
                <span><i className="bi bi-speedometer2 me-2"></i>Admin Panel</span>
                {window.innerWidth < 992 && (
                  <button className="btn btn-sm btn-light ms-2" onClick={onClose} aria-label="Close sidebar">
                    <i className="bi bi-x-lg"></i>
                  </button>
                )}
              </div>
              <nav className="nav flex-column px-3 mt-3">
                <a
                  className={`nav-link${active === 'add' ? ' active' : ''}`}
                  href="#add"
                  onClick={e => { e.preventDefault(); setActive('add'); if (window.innerWidth < 992) onClose(); }}
                >
                  <i className="bi bi-person-plus me-2"></i>Add User
                </a>
                <a
                  className={`nav-link${active === 'view' ? ' active' : ''}`}
                  href="#view"
                  onClick={e => { e.preventDefault(); setActive('view'); if (window.innerWidth < 992) onClose(); }}
                >
                  <i className="bi bi-people me-2"></i>View Users
                </a>
              </nav>
            </div>
            {/* Only show overlay on mobile/tablet when sidebar is open */}
            {window.innerWidth < 992 && (
              <div className={`overlay${open ? ' show' : ''}`} onClick={onClose}></div>
            )}
          </>
        );
      }

      function TopNavbar({ onSidebarToggle }) {
        return (
          <nav className="navbar navbar-expand navbar-light sticky-top px-3 shadow-sm animate__animated animate__fadeInDown">
            <button className="sidebar-toggler d-lg-none" onClick={onSidebarToggle} aria-label="Open sidebar">
              <i className="bi bi-list"></i>
            </button>
            <span className="navbar-brand fw-bold text-primary">Email, Gender & City Admin</span>
          </nav>
        );
      }

      function UsersTable({ users }) {
        return (
          <div className="container py-4 d-flex flex-column align-items-center animate__animated animate__fadeInUp">
            <div className="mb-4">
              <h2 className="fw-bold text-center">User List</h2>
              <p className="text-muted text-center">All users from Supabase</p>
            </div>
            <div className="table-responsive shadow-lg" style={{ maxWidth: 700, width: '100%', background: '#fff' }}>
              <table className="table table-hover align-middle mb-0">
                <thead className="table-primary">
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Email</th>
                    <th scope="col">Gender</th>
                    <th scope="col">City</th>
                  </tr>
                </thead>
                <tbody>
                  {users.length === 0 ? (
                    <tr>
                      <td colSpan="4" className="text-center text-muted">No users found.</td>
                    </tr>
                  ) : (
                    users.map((user, idx) => (
                      <tr key={user.id || idx} className="animate__animated animate__fadeIn animate__faster">
                        <th scope="row">{idx + 1}</th>
                        <td>{user.email || <span className="text-muted">N/A</span>}</td>
                        <td>{user.gender || <span className="text-muted">N/A</span>}</td>
                        <td>{user.city || <span className="text-muted">N/A</span>}</td>
                      </tr>
                    ))
                  )}
                </tbody>
              </table>
            </div>
          </div>
        );
      }

      function SingleUserCard({ user }) {
        return (
          <div className="container py-4 d-flex flex-column justify-content-center align-items-center animate__animated animate__fadeInUp">
            <div className="card shadow-lg" style={{ maxWidth: 400, width: '100%' }}>
              <div className="card-body">
                <h3 className="card-title mb-4 text-center fw-bold">User Info</h3>
                <ul className="list-group list-group-flush">
                  <li className="list-group-item d-flex justify-content-between align-items-center">
                    <span className="fw-semibold">Email:</span>
                    <span>{user.email || <span className="text-muted">N/A</span>}</span>
                  </li>
                  <li className="list-group-item d-flex justify-content-between align-items-center">
                    <span className="fw-semibold">Gender:</span>
                    <span>{user.gender || <span className="text-muted">N/A</span>}</span>
                  </li>
                  <li className="list-group-item d-flex justify-content-between align-items-center">
                    <span className="fw-semibold">City:</span>
                    <span>{user.city || <span className="text-muted">N/A</span>}</span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        );
      }

      function UserForm({ onUserAdded }) {
        const [form, setForm] = React.useState({ email: '', gender: '', city: '' });
        const [errors, setErrors] = React.useState({});
        const [submitting, setSubmitting] = React.useState(false);
        const [success, setSuccess] = React.useState(null);
        const [fail, setFail] = React.useState(null);

        function validate() {
          const errs = {};
          if (!form.email) {
            errs.email = 'Email is required.';
          } else if (!/^\S+@\S+\.\S+$/.test(form.email)) {
            errs.email = 'Invalid email address.';
          }
          if (!form.gender) {
            errs.gender = 'Gender is required.';
          }
          if (!form.city) {
            errs.city = 'City is required.';
          }
          return errs;
        }

        async function handleSubmit(e) {
          e.preventDefault();
          setSuccess(null);
          setFail(null);
          const errs = validate();
          setErrors(errs);
          if (Object.keys(errs).length > 0) return;
          setSubmitting(true);
          const { data, error } = await supabase.from('addusers').insert([
            { email: form.email, gender: form.gender, city: form.city }
          ]);
          setSubmitting(false);
          if (error) {
            setFail(error.message);
          } else {
            setSuccess('User added successfully!');
            setForm({ email: '', gender: '', city: '' });
            if (onUserAdded) onUserAdded();
          }
        }

        return (
          <div className="form-section animate__animated animate__fadeInDown">
            <div className="card shadow-lg">
              <div className="card-body">
                <h4 className="card-title mb-3 fw-bold text-center">Add User</h4>
                {success && <div className="alert alert-success animate__animated animate__fadeIn mb-3"><i className="bi bi-check-circle me-2"></i>{success}</div>}
                {fail && <div className="alert alert-danger animate__animated animate__fadeIn mb-3"><i className="bi bi-x-circle me-2"></i>{fail}</div>}
                <form onSubmit={handleSubmit} noValidate>
                  <div className="mb-3">
                    <label htmlFor="email" className="form-label">Email</label>
                    <input
                      type="email"
                      className={`form-control${errors.email ? ' is-invalid' : ''}`}
                      id="email"
                      placeholder="Enter email"
                      value={form.email}
                      onChange={e => setForm(f => ({ ...f, email: e.target.value }))}
                      autoComplete="off"
                    />
                    {errors.email && <div className="invalid-feedback">{errors.email}</div>}
                  </div>
                  <div className="mb-3">
                    <label htmlFor="gender" className="form-label">Gender</label>
                    <select
                      className={`form-select${errors.gender ? ' is-invalid' : ''}`}
                      id="gender"
                      value={form.gender}
                      onChange={e => setForm(f => ({ ...f, gender: e.target.value }))}
                    >
                      <option value="">Select gender</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                      <option value="Other">Other</option>
                    </select>
                    {errors.gender && <div className="invalid-feedback">{errors.gender}</div>}
                  </div>
                  <div className="mb-3">
                    <label htmlFor="city" className="form-label">City</label>
                    <input
                      type="text"
                      className={`form-control${errors.city ? ' is-invalid' : ''}`}
                      id="city"
                      placeholder="Enter city"
                      value={form.city}
                      onChange={e => setForm(f => ({ ...f, city: e.target.value }))}
                      autoComplete="off"
                    />
                    {errors.city && <div className="invalid-feedback">{errors.city}</div>}
                  </div>
                  <button type="submit" className="btn btn-primary w-100" disabled={submitting}>
                    {submitting ? (
                      <span><span className="spinner-border spinner-border-sm me-2"></span>Adding...</span>
                    ) : (
                      <span><i className="bi bi-plus-circle me-2"></i>Add User</span>
                    )}
                  </button>
                </form>
              </div>
            </div>
          </div>
        );
      }

      function AdminPanel() {
        const [sidebarOpen, setSidebarOpen] = React.useState(false);
        const [active, setActive] = React.useState('add');
        const [users, setUsers] = React.useState(null);
        const [loading, setLoading] = React.useState(true);
        const [error, setError] = React.useState(null);
        const [refresh, setRefresh] = React.useState(0);

        React.useEffect(() => {
          async function fetchUsers() {
            setLoading(true);
            setError(null);
            const { data, error } = await supabase
              .from('addusers')
              .select('id, email, gender, city')
              .order('id', { ascending: false });
            if (error) {
              setError(error.message);
              setUsers([]);
            } else {
              setUsers(data || []);
            }
            setLoading(false);
          }
          if (active === 'view') {
            fetchUsers();
          }
        }, [refresh, active]);

        function handleUserAdded() {
          setActive('view');
          setRefresh(r => r + 1);
        }

        // Responsive sidebar collapse on resize
        React.useEffect(() => {
          function handleResize() {
            if (window.innerWidth >= 992) {
              setSidebarOpen(false);
            }
          }
          window.addEventListener('resize', handleResize);
          return () => window.removeEventListener('resize', handleResize);
        }, []);

        return (
          <div className="d-flex" style={{ minHeight: '100vh' }}>
            <Sidebar
              collapsed={window.innerWidth < 992 && !sidebarOpen}
              open={sidebarOpen || window.innerWidth >= 992}
              onClose={() => setSidebarOpen(false)}
              active={active}
              setActive={setActive}
            />
            <div className="flex-grow-1 d-flex flex-column" style={{ minHeight: '100vh' }}>
              <TopNavbar onSidebarToggle={() => setSidebarOpen(true)} />
              <main className="main-content">
                {active === 'add' && <UserForm onUserAdded={handleUserAdded} />}
                {active === 'view' && (
                  loading ? (
                    <div className="spinner-container">
                      <div className="spinner-border text-primary" style={{ width: '3rem', height: '3rem' }} role="status">
                        <span className="visually-hidden">Loading...</span>
                      </div>
                    </div>
                  ) : error ? (
                    <div className="container d-flex flex-column justify-content-center align-items-center">
                      <div className="alert alert-danger animate__animated animate__fadeInDown mt-4" role="alert">
                        <i className="bi bi-exclamation-triangle me-2"></i>
                        {error}
                      </div>
                    </div>
                  ) : !users || users.length === 0 ? (
                    <div className="container d-flex flex-column justify-content-center align-items-center">
                      <div className="alert alert-info animate__animated animate__fadeInDown mt-4" role="alert">
                        <i className="bi bi-info-circle me-2"></i>
                        No users found in Supabase.
                      </div>
                    </div>
                  ) : users.length === 1 ? (
                    <SingleUserCard user={users[0]} />
                  ) : (
                    <UsersTable users={users} />
                  )
                )}
              </main>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<AdminPanel />);
    </script>
  </body>
</html>
